package org.opentestsystem.ap.tms.packager.service;

import org.opentestsystem.ap.common.config.ItemBankProperties;
import org.opentestsystem.ap.tms.packager.manager.FixedFormPackagerManager;
import org.opentestsystem.ap.tms.packager.model.FixedFormPackageRequest;
import org.opentestsystem.ap.tms.packager.util.PackagerFileUtil;
import org.springframework.stereotype.Service;

@Service
public class FixedFormPackagerService {
    private final FixedFormPackagerManager formPackagerManager;

    private final FixedFormPackageValidator formPackageValidator;

    private final ItemBankProperties itemBankProperties;

    private final PackagerFileUtil packagerFileUtil;

    public FixedFormPackagerService(FixedFormPackagerManager formPackagerManager,
                                    FixedFormPackageValidator formPackageValidator,
                                    ItemBankProperties itemBankProperties,
                                    PackagerFileUtil packagerFileUtil) {
        this.formPackagerManager = formPackagerManager;
        this.formPackageValidator = formPackageValidator;
        this.itemBankProperties = itemBankProperties;
        this.packagerFileUtil = packagerFileUtil;
    }

    public void generateFixedFormPackage(FixedFormPackageRequest packageRequest) {
        //validate packageRequest
        formPackageValidator.validateFixedFormPackageRequest(packageRequest);

        String inputSpreadsheetPath = packagerFileUtil.writeFile(packageRequest.getFile());
        String outputPath = packagerFileUtil.createTempDirectory();

        formPackagerManager.generateFixedFormPackage(inputSpreadsheetPath, outputPath, packageRequest.isDebug());
    }
}
