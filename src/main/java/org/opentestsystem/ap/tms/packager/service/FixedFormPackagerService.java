package org.opentestsystem.ap.tms.packager.service;

import org.opentestsystem.ap.tms.packager.manager.FixedFormPackagerManager;
import org.opentestsystem.ap.tms.packager.model.FixedFormPackageRequest;
import org.opentestsystem.ap.tms.packager.util.PackagerFileUtil;
import org.springframework.stereotype.Service;

import java.io.File;
import java.util.Optional;

@Service
public class FixedFormPackagerService {
    private final FixedFormPackagerManager formPackagerManager;

    private final FixedFormPackageValidator formPackageValidator;

    private final PackagerFileUtil packagerFileUtil;

    public FixedFormPackagerService(FixedFormPackagerManager formPackagerManager,
                                    FixedFormPackageValidator formPackageValidator,
                                    PackagerFileUtil packagerFileUtil) {
        this.formPackagerManager = formPackagerManager;
        this.formPackageValidator = formPackageValidator;
        this.packagerFileUtil = packagerFileUtil;
    }

    public Optional<File> generateFixedFormPackage(FixedFormPackageRequest packageRequest) {
        //validate packageRequest
        formPackageValidator.validateFixedFormPackageRequest(packageRequest);

        String inputSpreadsheetPath = packagerFileUtil.writeFile(packageRequest.getFile());
        String outputPath = packagerFileUtil.createTempDirectory();

        return formPackagerManager.generateFixedFormPackage(inputSpreadsheetPath, outputPath);
    }
}
