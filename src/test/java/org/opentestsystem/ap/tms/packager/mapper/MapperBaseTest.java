package org.opentestsystem.ap.tms.packager.mapper;

import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import com.fasterxml.jackson.datatype.jdk8.Jdk8Module;
import com.google.common.collect.ImmutableMap;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.junit.Before;
import org.opentestsystem.ap.common.model.AssessmentItem;
import org.opentestsystem.ap.common.model.EbsrItem;
import org.opentestsystem.ap.tms.packager.model.xlsx.TestPackageWorkbook;
import org.opentestsystem.ap.tms.packager.util.CommonTestUtil;

import java.util.Map;

import static org.opentestsystem.ap.common.model.ModelConstants.ItemType.TYPE_EBSR;

public class MapperBaseTest {
    protected TestPackageWorkbook mockIABWorkbook;
    protected Map<String, AssessmentItem> itemMetadataIAB;

    protected TestPackageWorkbook mockICAWorkbook;
    protected Map<String, AssessmentItem> itemMetadataICA;

    protected XmlMapper xmlMapper;

    protected CommonTestUtil commonTestUtil;

    @Before
    public void setup() throws Exception {
        commonTestUtil = new CommonTestUtil();

        xmlMapper = new XmlMapper();
        xmlMapper.registerModule(new Jdk8Module());

        mockIABWorkbook = new TestPackageWorkbook(new XSSFWorkbook(
                this.getClass().getResourceAsStream("/SBAC-IAB-FIXED-G11M-Winter-2017-2018.xlsx")));

        mockICAWorkbook = new TestPackageWorkbook(new XSSFWorkbook(
                this.getClass().getResourceAsStream("/SBAC-ICA-FIXED-G11M-Winter-2017-2018.xlsx")));

        EbsrItem item183240 = (EbsrItem) commonTestUtil.getItemFactory().newItem("183240", TYPE_EBSR);
        item183240.getCore().getEn().setPrompt(commonTestUtil.getPromptWithHtmlTable());
        item183240.getCore().getEn().setPartAPrompt("This is a multiple choice.");
        item183240.getCore().getEn().setPartAOptions(commonTestUtil.newMultipleChoiceOptions());
        item183240.getCore().getEn().setPartBPrompt("This is a multiple select.");
        item183240.getCore().getEn().setPartBOptions(commonTestUtil.newMultipleSelectOptions());
        item183240.getServerManaged().setId("183240");
        item183240.getServerManaged().setItsId("3240");
        item183240.getServerManaged().setPrimaryEnhancedId("M.G5.C1NF.TF.5.NF.5a");
        item183240.getServerManaged().setPrimaryLegacyId("SBAC-MA-v6:1|P|TS02|F-5");
        item183240.getServerManaged().setPrimaryLegacyV4Id("SBAC-MA-v4:1|NF|F-5|m|5.NF.5a");
        item183240.getWorkflow().setWorkflowStatusCode("Released");

        itemMetadataIAB = ImmutableMap.<String, AssessmentItem>builder()
                .put("183240", item183240)
                .build();
    }
}
